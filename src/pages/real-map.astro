<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¨Ø§Øº Ø¢ÛŒÙ†Ø¯Ù‡ - Iran Interactive Map</title>
  
  <!-- Local Leaflet CSS -->
  <link rel="stylesheet" href="/Bagh-e-Ayandeh/leaflet/leaflet.css" />
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    #map {
      width: 100vw;
      height: 100vh;
      filter: contrast(0.95) saturate(0.9);
    }
    
    .leaflet-popup-content {
      text-align: center;
      font-family: system-ui, sans-serif;
    }
    
    .leaflet-popup-content strong {
      font-size: 18px;
      display: block;
      margin-bottom: 8px;
    }
    
    .explore-btn {
      margin-top: 10px;
      padding: 10px 20px;
      background: linear-gradient(to right, #059669, #0ea5e9);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }
    
    .explore-btn:hover {
      transform: scale(1.05);
    }
    
    /* Highlight Iran */
    .iran-highlight {
      fill: rgba(5, 150, 105, 0.15);
      stroke: #059669;
      stroke-width: 3;
      stroke-opacity: 0.8;
      pointer-events: none;
    }
    
    /* Dim surrounding countries */
    .world-overlay {
      fill: rgba(200, 200, 200, 0.3);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Local Leaflet JS -->
  <script is:inline src="/Bagh-e-Ayandeh/leaflet/leaflet.js"></script>
  
  <script is:inline>
    console.log('Loading map with Iran focus...');
    
    // Initialize map centered on Iran
    const map = L.map('map', {
      center: [32.4279, 53.6880],
      zoom: 6,
      minZoom: 5,
      maxZoom: 18
    });

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 18
    }).addTo(map);

    // Iran boundary (simplified GeoJSON polygon)
    const iranBoundary = {
      "type": "Feature",
      "properties": { "name": "Iran" },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [44.0, 39.5], [47.5, 39.0], [48.5, 38.5], [49.5, 37.5],
          [50.0, 37.0], [53.0, 37.0], [54.0, 37.5], [56.0, 38.0],
          [58.0, 37.5], [60.0, 37.0], [61.5, 36.5], [61.0, 35.5],
          [60.5, 35.0], [61.0, 34.0], [61.0, 33.0], [60.5, 32.0],
          [60.0, 31.0], [61.0, 30.0], [61.5, 29.5], [61.0, 28.5],
          [60.5, 27.5], [60.0, 27.0], [59.0, 27.5], [58.0, 27.0],
          [57.5, 26.5], [56.5, 26.0], [55.0, 26.5], [54.0, 26.5],
          [53.5, 27.0], [52.5, 27.5], [51.5, 27.5], [50.5, 28.0],
          [49.5, 29.0], [48.5, 29.5], [48.0, 30.0], [47.5, 30.5],
          [46.5, 29.5], [45.5, 29.0], [45.0, 29.5], [44.5, 30.0],
          [44.0, 31.0], [44.5, 32.0], [45.0, 33.0], [45.5, 34.0],
          [46.0, 35.0], [45.5, 36.0], [45.0, 37.0], [44.5, 38.0],
          [44.0, 39.5]
        ]]
      }
    };

    // Add Iran highlight
    L.geoJSON(iranBoundary, {
      style: {
        className: 'iran-highlight',
        fillColor: '#059669',
        fillOpacity: 0.15,
        color: '#059669',
        weight: 3,
        opacity: 0.8
      }
    }).addTo(map);

    // Create inverted mask (everything except Iran gets dimmed)
    const worldBounds = [
      [-90, -180], [-90, 180], [90, 180], [90, -180], [-90, -180]
    ];
    const iranCoords = iranBoundary.geometry.coordinates[0].map(c => [c[1], c[0]]);
    
    L.polygon([worldBounds, iranCoords], {
      color: 'transparent',
      fillColor: '#888',
      fillOpacity: 0.25,
      interactive: false,
      className: 'world-overlay'
    }).addTo(map);

    const basePath = '/Bagh-e-Ayandeh';

    // Cities data
    const cities = [
      { 
        name: 'Shiraz Ø´ÛŒØ±Ø§Ø²', 
        coords: [29.5918, 52.5836], 
        available: true, 
        url: basePath + '/shiraz',
        description: 'ðŸ›ï¸ Birthplace of Hafez & Saadi'
      },
      { 
        name: 'Tehran ØªÙ‡Ø±Ø§Ù†', 
        coords: [35.6892, 51.3890], 
        available: false,
        description: 'ðŸ™ï¸ Capital (coming soon)'
      },
      { 
        name: 'Isfahan Ø§ØµÙÙ‡Ø§Ù†', 
        coords: [32.6546, 51.6680], 
        available: false,
        description: 'ðŸ•Œ Half of the World (coming soon)'
      },
      { 
        name: 'Tabriz ØªØ¨Ø±ÛŒØ²', 
        coords: [38.0962, 46.2738], 
        available: false,
        description: 'ðŸ”ï¸ Historic city (coming soon)'
      },
      { 
        name: 'Mashhad Ù…Ø´Ù‡Ø¯', 
        coords: [36.2605, 59.6168], 
        available: false,
        description: 'ðŸ•Œ Spiritual center (coming soon)'
      }
    ];

    cities.forEach(city => {
      const marker = L.circleMarker(city.coords, {
        radius: city.available ? 14 : 10,
        fillColor: city.available ? '#0ea5e9' : '#94a3b8',
        color: '#fff',
        weight: 4,
        opacity: 1,
        fillOpacity: 0.9
      }).addTo(map);

      const popupContent = city.available ? 
        `<strong>${city.name}</strong><br>${city.description}<br><button class="explore-btn" onclick="window.location.href='${city.url}'">Explore â†’</button>` :
        `<strong>${city.name}</strong><br>${city.description}`;

      marker.bindPopup(popupContent, {
        maxWidth: 250,
        className: 'city-popup'
      });
      
      if (city.available) {
        marker.on('click', function() {
          marker.openPopup();
        });
      }
    });
    
    console.log('âœ“ Iran-focused map loaded successfully!');
  </script>
</body>
</html>
