<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¨Ø§Øº Ø¢ÛŒÙ†Ø¯Ù‡ - Iran Interactive Map</title>
  
  <!-- Local Leaflet CSS -->
  <link rel="stylesheet" href="/Bagh-e-Ayandeh/leaflet/leaflet.css" />
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    #map {
      width: 100vw;
      height: 100vh;
    }
    
    .leaflet-popup-content {
      text-align: center;
      font-family: system-ui, sans-serif;
    }
    
    .leaflet-popup-content strong {
      font-size: 18px;
      display: block;
      margin-bottom: 8px;
    }
    
    .explore-btn {
      margin-top: 10px;
      padding: 10px 20px;
      background: linear-gradient(to right, #059669, #0ea5e9);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }
    
    .explore-btn:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Local Leaflet JS -->
  <script is:inline src="/Bagh-e-Ayandeh/leaflet/leaflet.js"></script>
  
  <script is:inline>
    console.log('Loading Iran-focused map...');
    
    // Initialize map centered on Iran
    const map = L.map('map', {
      center: [32.4279, 53.6880],
      zoom: 6,
      minZoom: 5,
      maxZoom: 18
    });

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 18
    }).addTo(map);

    // Iran boundary (more accurate approximation)
    const iranBoundary = {
      "type": "Feature",
      "properties": { "name": "Iran" },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [44.04, 39.43], [44.77, 39.71], [45.46, 39.00], [46.14, 38.74],
          [46.51, 38.77], [47.68, 39.51], [48.01, 39.58], [48.35, 39.46],
          [48.57, 39.80], [48.88, 38.32], [49.20, 37.58], [50.15, 37.37],
          [50.84, 36.87], [52.26, 36.70], [53.83, 36.97], [53.92, 37.34],
          [54.80, 37.39], [55.51, 37.96], [56.18, 37.94], [56.62, 38.12],
          [57.33, 38.03], [58.44, 37.52], [59.23, 37.41], [60.38, 36.53],
          [61.12, 36.64], [61.21, 35.65], [60.80, 34.40], [60.52, 33.68],
          [60.96, 33.52], [60.54, 32.99], [60.86, 31.48], [61.78, 30.83],
          [61.37, 29.30], [60.87, 29.13], [61.66, 27.25], [62.35, 26.54],
          [63.32, 26.76], [61.87, 26.24], [61.50, 25.08], [59.62, 25.38],
          [58.53, 25.61], [57.40, 25.74], [56.97, 26.96], [56.49, 27.14],
          [55.72, 26.96], [54.72, 26.48], [53.49, 26.81], [52.48, 27.58],
          [51.52, 27.87], [50.84, 28.81], [50.11, 30.15], [49.58, 29.99],
          [48.94, 30.32], [48.57, 29.93], [48.01, 30.45], [47.69, 30.09],
          [47.85, 29.98], [46.56, 29.10], [44.71, 29.18], [44.23, 29.94],
          [44.42, 31.71], [45.42, 33.97], [46.11, 34.98], [45.42, 35.98],
          [44.77, 37.17], [44.23, 37.97], [44.42, 38.28], [44.04, 39.43]
        ]]
      }
    };

    // Create inverted mask (dim everything except Iran)
    const worldBounds = [
      [-90, -180], [-90, 180], [90, 180], [90, -180], [-90, -180]
    ];
    const iranCoords = iranBoundary.geometry.coordinates[0].map(c => [c[1], c[0]]);
    
    L.polygon([worldBounds, iranCoords], {
      color: 'transparent',
      fillColor: '#000',
      fillOpacity: 0.35,
      interactive: false
    }).addTo(map);

    const basePath = '/Bagh-e-Ayandeh';

    // Cities data
    const cities = [
      { 
        name: 'Shiraz Ø´ÛŒØ±Ø§Ø²', 
        coords: [29.5918, 52.5836], 
        available: true, 
        url: basePath + '/shiraz',
        description: 'ðŸ›ï¸ Birthplace of Hafez & Saadi'
      },
      { 
        name: 'Tehran ØªÙ‡Ø±Ø§Ù†', 
        coords: [35.6892, 51.3890], 
        available: false,
        description: 'ðŸ™ï¸ Capital (coming soon)'
      },
      { 
        name: 'Isfahan Ø§ØµÙÙ‡Ø§Ù†', 
        coords: [32.6546, 51.6680], 
        available: false,
        description: 'ðŸ•Œ Half of the World (coming soon)'
      },
      { 
        name: 'Tabriz ØªØ¨Ø±ÛŒØ²', 
        coords: [38.0962, 46.2738], 
        available: false,
        description: 'ðŸ”ï¸ Historic city (coming soon)'
      },
      { 
        name: 'Mashhad Ù…Ø´Ù‡Ø¯', 
        coords: [36.2605, 59.6168], 
        available: false,
        description: 'ðŸ•Œ Spiritual center (coming soon)'
      }
    ];

    cities.forEach(city => {
      const marker = L.circleMarker(city.coords, {
        radius: city.available ? 14 : 10,
        fillColor: city.available ? '#0ea5e9' : '#94a3b8',
        color: '#fff',
        weight: 4,
        opacity: 1,
        fillOpacity: 0.9
      }).addTo(map);

      const popupContent = city.available ? 
        `<strong>${city.name}</strong><br>${city.description}<br><button class="explore-btn" onclick="window.location.href='${city.url}'">Explore â†’</button>` :
        `<strong>${city.name}</strong><br>${city.description}`;

      marker.bindPopup(popupContent, {
        maxWidth: 250,
        className: 'city-popup'
      });
      
      if (city.available) {
        marker.on('click', function() {
          marker.openPopup();
        });
      }
    });
    
    console.log('âœ“ Iran-focused map loaded!');
  </script>
</body>
</html>
